<nz-page-header class="mobile-header" nzTitle="Gerenciar Fichas"></nz-page-header>
<nz-divider></nz-divider>

<form nz-form nzLayout="vertical" [formGroup]="reportFilterForm" (ngSubmit)="getReports()">
  <h1>Filtros</h1>
  <nz-row nzGutter="12">

    <nz-col nzSm="8" nzXs="24">
      <nz-form-item>
        <nz-form-label>Paciente</nz-form-label>
        <nz-form-control>
          <nz-select
            nzPlaceHolder="Selecione o paciente"
            nzAllowClear
            formControlName="pacientId"
            nzShowSearch
          >
            <nz-option
              *ngFor="let pacient of pacientsData"
              [nzValue]="pacient.pacientId"
              [nzLabel]="pacient.username"
            ></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </nz-col>
    <nz-col nzSm="8" nzXs="24">
      <nz-form-item>
        <nz-form-label>Problemas Cardiovasculares</nz-form-label>
        <nz-form-control>
          <nz-select
            nzPlaceHolder="Selecionar"
            nzAllowClear
            nzShowSearch
            formControlName="familyHistoryCardiovascularIssues"
            required>
            <nz-option [nzValue]="true" [nzLabel]="'Sim'"></nz-option>
            <nz-option [nzValue]="false" [nzLabel]="'Não'"></nz-option>
            <nz-option [nzValue]='' [nzLabel]="'Todos'"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </nz-col>
    <nz-col nzSm="8" nzXs="24">
      <nz-form-item>
        <nz-form-label>Diabetes</nz-form-label>
        <nz-form-control>
          <nz-select
            nzPlaceHolder="Selecionar"
            nzAllowClear
            nzShowSearch
            formControlName="diabetes"
            required>
            <nz-option [nzValue]="true" [nzLabel]="'Sim'"></nz-option>
            <nz-option [nzValue]="false" [nzLabel]="'Não'"></nz-option>
            <nz-option [nzValue]='' [nzLabel]="'Todos'"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </nz-col>

    <nz-col nzSm="8" nzXs="24">
      <nz-form-item>
        <nz-form-label>Fumante</nz-form-label>
        <nz-form-control>
          <nz-select
            nzPlaceHolder="Selecionar"
            nzAllowClear
            nzShowSearch
            formControlName="smoker"
            required>
            <nz-option [nzValue]="true" [nzLabel]="'Sim'"></nz-option>
            <nz-option [nzValue]="false" [nzLabel]="'Não'"></nz-option>
            <nz-option [nzValue]='' [nzLabel]="'Todos'"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </nz-col>
  </nz-row>

  <nz-row>
    <nz-col class="button-group" nzSpan="24">
      <button
        nz-button
        nzSize="large"
        type="button"
        style="margin-right: 5px"
        [nzLoading]="isLoading"
        [disabled]="isLoading"
        (click)="clearForm()"
      >
        Limpar
      </button>
      <button
        nz-button
        nzType="primary"
        nzSize="large"
        type="submit"
        [disabled]="isLoading"
        [nzLoading]="isLoading"
      >
        <i nz-icon nzType="search" nzTheme="outline"></i>
        Filtrar
      </button>

    </nz-col>
  </nz-row>
</form>

<nz-spin [nzSpinning]="isLoading">
  <nz-divider
    nzText="Encontrados: {{ totalReports }} "
    nzOrientation="left"
    *ngIf="!!totalReports"></nz-divider>
  <div nz-row class="table-responsive">
    <nz-table
      nzShowSizeChanger
      [nzData]="pacientsData"
      nzSize="default"
      [nzFrontPagination]="false"
      [nzShowPagination]="showPagination"
      [nzTotal]="totalReports"
      [nzPageIndex]="pageIndex"
      [nzPageSize]="pageSize"
      (nzPageIndexChange)="onPageIndexChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
    >
      <thead>
      <tr>
        <th>Ações</th>
        <th>Paciente</th>
        <th>Contato de emergencia</th>
        <th>Numero Contato Emergencia</th>
        <th>Problemas cardiovasculares</th>
        <th>Diabates</th>
        <th>Fumante</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let report of reportsData">
        <td>
          <button nz-button nzShape="circle" title="Editar ficha" style="margin-left: 5px"
                  (click)="openEditReportModal(report)">
            <span nz-icon nzType="edit"></span>
          </button>
        </td>
        <td>{{ report.pacientName }}</td>
        <td>{{ report.emergencyContactName ? report.emergencyContactName : '---' }}</td>
        <td>{{ report.emergencyContactPhone ? report.emergencyContactPhone : '---' }}</td>
        <td>{{ report.cardiovascularIssues ? 'Sim' : 'Não' }}</td>
        <td>{{ report.diabetes ? 'Sim' : 'Não' }}</td>
        <td>{{ report.smoker ? 'Sim' : 'Não' }}</td>
      </tr>
      </tbody>
    </nz-table>
  </div>
</nz-spin>


<!-----------------MODAL PARA EDITAR REPORT----------------->
<nz-modal
  [(nzVisible)]="showEditReportModal"
  nzTitle="Editar Ficha - {{selectedReport?.pacientName}}"
  [nzWidth]="800"
  (nzOnOk)="handleUpdateReport()"
  (nzOnCancel)="showEditReportModal = false"
>
  <div *nzModalContent>
    <form [formGroup]="editReportForm">
      <nz-tabset>
        <nz-tab nzTitle="Histórico Médico">
          <nz-row nzGutter="24">
            <nz-col nzSpan="24">
              <h3>Histórico</h3>
              <nz-form-item>
                <nz-form-control>
                  <textarea formControlName="medicalHistory" nz-input rows="3"></textarea>
                </nz-form-control>
              </nz-form-item>

              <h3>Medicações</h3>
              <nz-form-item>
                <nz-form-control>
                  <textarea formControlName="currentMedications" nz-input rows="3"></textarea>
                </nz-form-control>
              </nz-form-item>

              <h3>Observações</h3>
              <nz-form-item>
                <nz-form-control>
                  <textarea formControlName="observations" nz-input rows="3"></textarea>
                </nz-form-control>
              </nz-form-item>
            </nz-col>
          </nz-row>
        </nz-tab>

        <nz-tab nzTitle="Condições Clínicas">
          <nz-form-item>
            <label>
              <input type="checkbox" formControlName="cardiovascularIssues"/>
              Problemas Cardiovasculares
            </label>
          </nz-form-item>

          <nz-form-item>
            <label>
              <input type="checkbox" formControlName="diabetes"/>
              Diabetes
            </label>
          </nz-form-item>

          <nz-form-item>
            <label>
              <input type="checkbox" formControlName="familyHistoryCardiovascularIssues"/>
              Histórico Familiar Cardiovascular
            </label>
          </nz-form-item>

          <nz-form-item>
            <label>
              <input type="checkbox" formControlName="familyHistoryDiabetes"/>
              Histórico Familiar de Diabetes
            </label>
          </nz-form-item>
        </nz-tab>


        <nz-tab nzTitle="Estilo de Vida">
          <h3>Atividade Física</h3>
          <nz-form-item>
            <nz-form-control>
              <input formControlName="physicalActivity" nz-input placeholder="Ex: Caminhada 3x por semana"/>
            </nz-form-control>
          </nz-form-item>


          <h3>Consumo de Álcool (0-10)</h3>
          <nz-form-item>
            <nz-form-control>
              <input type="number" formControlName="alcoholConsumption" nz-input min="0" max="10"/>
            </nz-form-control>
          </nz-form-item>

          <h3>Fumante</h3>
          <nz-form-item>
            <nz-form-control>
              <input type="checkbox" formControlName="smoker"/>
            </nz-form-control>
          </nz-form-item>
        </nz-tab>

        <nz-tab nzTitle="Contato de Emergência">
          <h3>Nome</h3>
          <nz-form-item>
            <nz-form-control>
              <input formControlName="emergencyContactName" nz-input/>
            </nz-form-control>
          </nz-form-item>

          <h3>Telefone</h3>
          <nz-form-item>
            <nz-form-control>
              <input formControlName="emergencyContactPhone" nz-input placeholder="(00) 00000-0000"
                     mask="(00) 0*-0000"/>
            </nz-form-control>
          </nz-form-item>
        </nz-tab>
      </nz-tabset>
    </form>
  </div>
</nz-modal>


